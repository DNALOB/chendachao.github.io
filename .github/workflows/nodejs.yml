name: Github Actions

on: [push]

jobs:

  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
    - uses: actions/checkout@v1
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}
    - name: npm install, build
      run: |
        npm install
        npm run build --if-present

#        REMOTE=https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
#        git config user.email "${{ github.actor }}@users.noreply.github.com"
#        git config user.name "${{ github.actor }}"
#
#        git pull ${REMOTE}
#        git checkout master
#        echo 123 > index.html
#        git add .
#        git status
#        git commit -am "Add new comment"
#        git push ${REMOTE} master

  publish:
    needs: [build]
    runs-on: ubuntu-18.04
    strategy:
      matrix:
        node-version: [12.x]
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}
    - name: Deploy
      run: |
        npm install
        npm run build
        npm run deploy
      env:
        CI: true
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}


  lighthouse-check:
      needs: [build]
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@master
        - run: mkdir /tmp/artifacts
        - name: Run Lighthouse
          uses: foo-software/lighthouse-check-action@master
          id: lighthouseCheck
          with:
            outputDirectory: /tmp/artifacts
            urls: 'https://chendachao.github.io'
        - name: Upload artifacts
          uses: actions/upload-artifact@master
          with:
            name: Lighthouse reports
            path: /tmp/artifacts

